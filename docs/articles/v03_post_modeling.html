<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>flexsdm: Overview of Post-modeling functions • flexsdm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="flexsdm: Overview of Post-modeling functions">
<meta name="google-site-verification" content="gcou8tqRTwNjZ_Mf1kbFgAzzUcY3OF-JB2sPRPTA56I">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">flexsdm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01_pre_modeling.html">1. Overview of Pre-modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v02_modeling.html">2. Overview of Modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v03_post_modeling.html">3. Overview of Post-modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v04_Red_fir_example.html">4. An example with Red Fir</a></li>
    <li><a class="dropdown-item" href="../articles/v05_Rare_species_example.html">5. Modeling a rare species</a></li>
    <li><a class="dropdown-item" href="../articles/v06_Extrapolation_example.html">6. Tools to explore extrapolation in SDMs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/pkg_citation.html">Citations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/pkg_citation.html">Citations</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
<li class="nav-item"><a class="nav-link" href="https://sjevelazco.github.io/flexsdm" aria-label="GitHub">GitHub</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sjevelazco/flexsdm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>flexsdm: Overview of Post-modeling functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sjevelazco/flexsdm/blob/HEAD/vignettes/v03_post_modeling.Rmd" class="external-link"><code>vignettes/v03_post_modeling.Rmd</code></a></small>
      <div class="d-none name"><code>v03_post_modeling.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Species distribution modeling (SDM) has become a standard tool in
multiple research areas, including ecology, conservation biology,
biogeography, paleobiogeography, and epidemiology. SDM is an area of
active theoretical and methodological research The <em>flexsdm</em>
package provides users the ability to manipulate and parameterize models
in a variety of ways that meet their unique research needs.</p>
<p>This flexibility enables users to define their own complete or
partial modeling procedure specific for their modeling situations (e.g.,
number of variables, number of records, different algorithms and
ensemble methods, algorithms tuning, etc.).</p>
<p>In this vignette, users will learn about the post-modeling set of
functions in the <em>flexsdm</em> package. These functions were designed
with the aim of assisting the flexsdm user in predicting, evaluating,
and correcting SDMs.</p>
<p>These are the functions created for model prediction, evaluation and
correction:</p>
<p><strong>Post-modeling functions</strong></p>
<ul>
<li><p>sdm_predict() Spatial predictions from individual and ensemble
models</p></li>
<li><p>sdm_summarize() Merge model performance tables</p></li>
<li><p>interp() Raster interpolation between SDM predictions to two time
periods</p></li>
<li><p>extra_eval() Measure model extrapolation</p></li>
<li><p>extra_correct() Constraint suitability values under a given
extrapolation value</p></li>
<li><p>msdm_priori() Create spatial predictor variables to reduce
overprediction from species distribution models</p></li>
<li><p>msdm_posteriori() Methods to correct overprediction of species
distribution models based on occurrences and suitability
patterns</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the flexsdm package. You can install the released version of
<em>flexsdm</em> from <a href="https://github.com/sjevelazco/flexsdm" class="external-link">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::install_github('sjevelazco/flexsdm')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjevelazco.github.io/flexsdm">flexsdm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.60</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'terra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:knitr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     spin</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="project-directory-setup">Project directory setup<a class="anchor" aria-label="anchor" href="#project-directory-setup"></a>
</h2>
<p>Decide where on your computer you would like to store the inputs and
outputs of your project (this will be your main directory). Use an
existing one or use dir.create() to create your main directory. Then
specify whether or not to include folders for projections, calibration
areas, algorithms, ensembles, and thresholds. For more details see <a href="https://sjevelazco.github.io/flexsdm/articles/01_pre_modeling.html">Vignette
01_pre_modeling</a></p>
</div>
<div class="section level2">
<h2 id="species-occurrence-presenceabsense-and-environmental-data">Species occurrence, presence/absense and environmental data<a class="anchor" aria-label="anchor" href="#species-occurrence-presenceabsense-and-environmental-data"></a>
</h2>
<p>In this tutorial, we will be using the “spp” example dataset which
includes pr_ab (presence = 1, and absence = 0), location (x, y) data for
3 plant species found in California and a raster with environmental
data. You can load these data into your local R environment by using the
code below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spp"</span><span class="op">)</span></span>
<span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span></code></pre></div>
<p>If you want to replace the spp dataset with your own data, make sure
that contains coordinates, species presence = 1 / absence = 0 and a
raster with environmental data.</p>
<p>First, prepare the occurrences, environmental conditions and
partitions</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select only one species</span></span>
<span><span class="va">some_sp</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp3"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the environmental condition from the rsater for sp3</span></span>
<span><span class="va">some_sp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/sdm_extract.html">sdm_extract</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">some_sp</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    env_layer <span class="op">=</span> <span class="va">somevar</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; 4 rows were excluded from database because NAs were found</span></span>
<span></span>
<span><span class="co"># Make a partition defining the method, folds and replicates</span></span>
<span><span class="va">some_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">some_sp</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"rep_kfold"</span>, folds <span class="op">=</span> <span class="fl">3</span>, replicates <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, fit different models</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit and validate a [generalized linear model](https://sjevelazco.github.io/flexsdm/reference/fit_glm.html)</span></span>
<span><span class="va">mglm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_glm.html">fit_glm</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">some_sp</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CFP_1"</span>, <span class="st">"CFP_2"</span>, <span class="st">"CFP_3"</span>, <span class="st">"CFP_4"</span><span class="op">)</span>,</span>
<span>  partition <span class="op">=</span> <span class="st">".part"</span>,</span>
<span>  poly <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula used for model fitting:</span></span>
<span><span class="co">#&gt; pr_ab ~ CFP_1 + CFP_2 + CFP_3 + CFP_4 + I(CFP_1^2) + I(CFP_2^2) + I(CFP_3^2) + I(CFP_4^2)</span></span>
<span><span class="co">#&gt; Replica number: 1/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 2/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 3/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 4/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 5/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span></span>
<span><span class="co"># Fit and validate a [random forest model](https://sjevelazco.github.io/flexsdm/reference/fit_raf.html)</span></span>
<span><span class="va">mraf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_raf.html">fit_raf</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">some_sp</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CFP_1"</span>, <span class="st">"CFP_2"</span>, <span class="st">"CFP_3"</span>, <span class="st">"CFP_4"</span><span class="op">)</span>,</span>
<span>  partition <span class="op">=</span> <span class="st">".part"</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula used for model fitting:</span></span>
<span><span class="co">#&gt; pr_ab ~ CFP_1 + CFP_2 + CFP_3 + CFP_4</span></span>
<span><span class="co">#&gt; Replica number: 1/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 2/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 3/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 4/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 5/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span></span>
<span><span class="co"># Fit and validate a [general boosted regression model](https://sjevelazco.github.io/flexsdm/reference/fit_gbm.html)</span></span>
<span><span class="va">mgbm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_gbm.html">fit_gbm</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">some_sp</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CFP_1"</span>, <span class="st">"CFP_2"</span>, <span class="st">"CFP_3"</span>, <span class="st">"CFP_4"</span><span class="op">)</span>,</span>
<span>  partition <span class="op">=</span> <span class="st">".part"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula used for model fitting:</span></span>
<span><span class="co">#&gt; pr_ab ~ CFP_1 + CFP_2 + CFP_3 + CFP_4</span></span>
<span><span class="co">#&gt; Replica number: 1/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 2/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 3/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 4/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span>
<span><span class="co">#&gt; Replica number: 5/5</span></span>
<span><span class="co">#&gt; Partition number: 1/3</span></span>
<span><span class="co">#&gt; Partition number: 2/3</span></span>
<span><span class="co">#&gt; Partition number: 3/3</span></span></code></pre></div>
<div class="section level3">
<h3 id="fit-and-ensemble-the-models-above">1. Fit and ensemble the models above<a class="anchor" aria-label="anchor" href="#fit-and-ensemble-the-models-above"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit and ensemble the models. To choose the arguments that best fit your own data, see all options available in [fit_ensemble](https://sjevelazco.github.io/flexsdm/reference/fit_ensemble.html)</span></span>
<span><span class="va">mensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ensemble.html">fit_ensemble</a></span><span class="op">(</span></span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mglm</span>, <span class="va">mraf</span>, <span class="va">mgbm</span><span class="op">)</span>,</span>
<span>  ens_method <span class="op">=</span> <span class="st">"meansup"</span>,</span>
<span>  thr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  thr_model <span class="op">=</span> <span class="st">"max_sens_spec"</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"TSS"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span></span></code></pre></div>
<p>You can also fit a model using an Ensembles of Small Models approach.
In this example, we fit without threshold specification and with k-fold
cross-validation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msmall</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/esm_gam.html">esm_gam</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">some_sp</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CFP_1"</span>, <span class="st">"CFP_2"</span>, <span class="st">"CFP_3"</span>, <span class="st">"CFP_4"</span><span class="op">)</span>,</span>
<span>  partition <span class="op">=</span> <span class="st">".part"</span>,</span>
<span>  thr <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |============                                                          |  17%  |                                                                              |=======================                                               |  33%  |                                                                              |===================================                                   |  50%  |                                                                              |===============================================                       |  67%  |                                                                              |==========================================================            |  83%  |                                                                              |======================================================================| 100%</span></span></code></pre></div>
<p>Finally, we can predict different kinds of models from the same data
(some_sp). <a href="https://sjevelazco.github.io/flexsdm/reference/sdm_predict.html">sdm_predict</a>
can be used for predicting one or more models fitted with fit_ or tune_
functions. The output will be a list of SpatRaster with continuous
and/or binary predictions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predict using a single model, which is an mglm model in this example,</span></span>
<span><span class="co"># and a threshold type for binary predictions</span></span>
<span><span class="va">ind_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_predict.html">sdm_predict</a></span><span class="op">(</span></span>
<span>  models <span class="op">=</span> <span class="va">mglm</span>,</span>
<span>  pred <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"max_fpb"</span>,</span>
<span>  con_thr <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  predict_area <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Predicting individual models</span></span>
<span></span>
<span><span class="co"># Inspect the object. It's a SpatRaster with 2 layers: glm, max_fpb</span></span>
<span><span class="co"># These are the continuous and binary prediction from the model</span></span>
<span><span class="va">ind_p</span></span>
<span><span class="co">#&gt; $glm</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 2  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varnames    : somevar </span></span>
<span><span class="co">#&gt;               somevar </span></span>
<span><span class="co">#&gt; names       :          glm, max_fpb </span></span>
<span><span class="co">#&gt; min values  : 2.220446e-16,    TRUE </span></span>
<span><span class="co">#&gt; max values  : 1.000000e+00,    TRUE</span></span>
<span></span>
<span><span class="co"># Plot to see this layers</span></span>
<span><span class="va">ind_p_rst</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ind_p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ind_p_rst</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/sdm_predict-1.png" width="576"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Predict a list of more than one model, specifying a threshold type</span></span>
<span><span class="va">list_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_predict.html">sdm_predict</a></span><span class="op">(</span></span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mglm</span>, <span class="va">mraf</span>, <span class="va">mgbm</span><span class="op">)</span>,</span>
<span>  pred <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"max_fpb"</span>,</span>
<span>  con_thr <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  predict_area <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Predicting list of individual models</span></span>
<span></span>
<span><span class="co"># Inspect the object. It's a list with 3 SpatRaster, one for each model,</span></span>
<span><span class="co"># each of which contains 2 layers, for the continuous and thresholded binary predictions.</span></span>
<span><span class="va">list_p</span></span>
<span><span class="co">#&gt; $glm</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 2  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varnames    : somevar </span></span>
<span><span class="co">#&gt;               somevar </span></span>
<span><span class="co">#&gt; names       :          glm, max_fpb </span></span>
<span><span class="co">#&gt; min values  : 2.220446e-16,    TRUE </span></span>
<span><span class="co">#&gt; max values  : 1.000000e+00,    TRUE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $raf</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 2  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varnames    : somevar </span></span>
<span><span class="co">#&gt;               somevar </span></span>
<span><span class="co">#&gt; names       : raf, max_fpb </span></span>
<span><span class="co">#&gt; min values  :   0,   FALSE </span></span>
<span><span class="co">#&gt; max values  :   1,    TRUE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $gbm</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 2  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varnames    : somevar </span></span>
<span><span class="co">#&gt;               somevar </span></span>
<span><span class="co">#&gt; names       :          gbm, max_fpb </span></span>
<span><span class="co">#&gt; min values  : 0.0002949323,   FALSE </span></span>
<span><span class="co">#&gt; max values  : 0.9986537352,    TRUE</span></span>
<span></span>
<span><span class="co"># Plot to see this layers</span></span>
<span><span class="va">list_p_rst</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">list_p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">list_p_rst</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/sdm_predict-2.png" width="576"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Predict an ensemble model. This is only possible using one fit_ensemble object. It's not possible to include e.g., list(fit_ensemble1, fit_ensemble2) in the model argument.</span></span>
<span><span class="va">ensemble_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_predict.html">sdm_predict</a></span><span class="op">(</span></span>
<span>  models <span class="op">=</span> <span class="va">mensemble</span>,</span>
<span>  pred <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"max_fpb"</span>,</span>
<span>  con_thr <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  predict_area <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Predicting ensembles</span></span>
<span></span>
<span><span class="co"># Inspect the object. It's a SpatRaster with 2 layers, mensemble and max_fpb</span></span>
<span><span class="co"># These are the continuous and binary prediction from the ensemble model</span></span>
<span><span class="va">ensemble_p</span></span>
<span><span class="co">#&gt; $meansup</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 2  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varnames    : somevar </span></span>
<span><span class="co">#&gt;               somevar </span></span>
<span><span class="co">#&gt; names       : meansup, max_fpb </span></span>
<span><span class="co">#&gt; min values  :       0,   FALSE </span></span>
<span><span class="co">#&gt; max values  :       1,    TRUE</span></span>
<span></span>
<span><span class="co"># Plot to see this layers</span></span>
<span><span class="va">ensemble_p_rst</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ensemble_p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ensemble_p_rst</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/sdm_predict-3.png" width="576"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Predict an ensembles of small models.</span></span>
<span><span class="va">small_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_predict.html">sdm_predict</a></span><span class="op">(</span></span>
<span>  models <span class="op">=</span> <span class="va">msmall</span>,</span>
<span>  pred <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"max_fpb"</span>,</span>
<span>  con_thr <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  predict_area <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Predicting ensemble of small models</span></span>
<span></span>
<span><span class="co"># Inspect the object It's a SpatRaster with 2 layers, msmall and max_fpb</span></span>
<span><span class="co"># These are the continuous and binary prediction from the ESM model</span></span>
<span><span class="va">small_p</span></span>
<span><span class="co">#&gt; $esm_gam</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 2  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       :      esm_gam, max_fpb </span></span>
<span><span class="co">#&gt; min values  : 2.476531e-05,   FALSE </span></span>
<span><span class="co">#&gt; max values  : 1.000000e+00,    TRUE</span></span>
<span></span>
<span><span class="co"># Plot to see this layers</span></span>
<span><span class="va">small_p_rst</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">small_p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">small_p_rst</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/sdm_predict-4.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="merge-model-performance-tables">2. Merge model performance tables<a class="anchor" aria-label="anchor" href="#merge-model-performance-tables"></a>
</h3>
<p>This function combines model performance tables for all input models.
This function requires a list of one or more models fitted with fit_ or
tune_ functions, a fit_ensemble output, or a esm_ family function
output.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load abies data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">abies</span><span class="op">)</span></span>
<span><span class="va">abies</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,400 × 13</span></span></span>
<span><span class="co">#&gt;       id pr_ab        x        y   aet   cwd  tmin ppt_djf ppt_jja    pH    awc</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   715     0  -<span style="color: #BB0000; text-decoration: underline;">95</span><span style="color: #BB0000;">417.</span>  <span style="text-decoration: underline;">314</span>240.  323.  546.  1.24    62.7   17.8   5.77 0.108 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">5</span>680     0   <span style="text-decoration: underline;">98</span>987. -<span style="color: #BB0000; text-decoration: underline;">159</span><span style="color: #BB0000;">415.</span>  448.  815.  9.43   130.     6.43  5.60 0.160 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">7</span>907     0  <span style="text-decoration: underline;">121</span>474.  -<span style="color: #BB0000; text-decoration: underline;">99</span><span style="color: #BB0000;">463.</span>  182.  271. -<span style="color: #BB0000;">4.95</span>   151.    11.2   0    0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>850     0  -<span style="color: #BB0000; text-decoration: underline;">39</span><span style="color: #BB0000;">976.</span>  -<span style="color: #BB0000; text-decoration: underline;">17</span><span style="color: #BB0000;">456.</span>  372.  946.  8.78   116.     2.70  6.41 0.097<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">1</span>702     0  <span style="text-decoration: underline;">111</span>372.  -<span style="color: #BB0000; text-decoration: underline;">91</span><span style="color: #BB0000;">404.</span>  209.  399. -<span style="color: #BB0000;">4.03</span>   165.     9.27  0    0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="text-decoration: underline;">10</span>036     0 -<span style="color: #BB0000; text-decoration: underline;">255</span><span style="color: #BB0000;">715.</span>  <span style="text-decoration: underline;">392</span>229.  308.  535.  4.66   166.    16.5   5.70 0.077<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="text-decoration: underline;">12</span>384     0 -<span style="color: #BB0000; text-decoration: underline;">311</span><span style="color: #BB0000;">765.</span>  <span style="text-decoration: underline;">380</span>213.  568.  352.  4.38   480.    41.2   5.80 0.110 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">6</span>513     0  <span style="text-decoration: underline;">111</span>360. -<span style="color: #BB0000; text-decoration: underline;">120</span><span style="color: #BB0000;">229.</span>  327.  633.  4.93   163.     8.91  1.18 0.011<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">9</span>884     0 -<span style="color: #BB0000; text-decoration: underline;">284</span><span style="color: #BB0000;">326.</span>  <span style="text-decoration: underline;">442</span>136.  377.  446.  3.99   296.    16.8   5.96 0.090<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">8</span>651     0  <span style="text-decoration: underline;">137</span>640. -<span style="color: #BB0000; text-decoration: underline;">110</span><span style="color: #BB0000;">538.</span>  215.  265. -<span style="color: #BB0000;">4.62</span>   180.     9.57  0    0     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,390 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: depth &lt;dbl&gt;, landform &lt;fct&gt;</span></span></span>
<span></span>
<span><span class="co"># We will partition the data with the k-fold method</span></span>
<span><span class="va">abies2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">abies</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kfold"</span>, folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Build some models to use for the performance table merge</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build a generalized additive model, and a generalized linear model using fit_ family functions</span></span>
<span><span class="va">gam_t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_gam.html">fit_gam</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">abies2</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aet"</span>, <span class="st">"ppt_jja"</span>, <span class="st">"pH"</span>, <span class="st">"awc"</span>, <span class="st">"depth"</span><span class="op">)</span>,</span>
<span>  predictors_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"landform"</span><span class="op">)</span>,</span>
<span>  partition <span class="op">=</span> <span class="st">".part"</span>,</span>
<span>  thr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max_sens_spec"</span>, <span class="st">"equal_sens_spec"</span>, <span class="st">"max_sorensen"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula used for model fitting:</span></span>
<span><span class="co">#&gt; pr_ab ~ s(aet, k = -1) + s(ppt_jja, k = -1) + s(pH, k = -1) + s(awc, k = -1) + s(depth, k = -1) + landform</span></span>
<span><span class="co">#&gt; Replica number: 1/1</span></span>
<span><span class="co">#&gt; Partition number: 1/5</span></span>
<span><span class="co">#&gt; Partition number: 2/5</span></span>
<span><span class="co">#&gt; Partition number: 3/5</span></span>
<span><span class="co">#&gt; Partition number: 4/5</span></span>
<span><span class="co">#&gt; Partition number: 5/5</span></span>
<span></span>
<span></span>
<span><span class="va">glm_t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_glm.html">fit_glm</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">abies2</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aet"</span>, <span class="st">"ppt_jja"</span>, <span class="st">"pH"</span>, <span class="st">"awc"</span>, <span class="st">"depth"</span><span class="op">)</span>,</span>
<span>  predictors_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"landform"</span><span class="op">)</span>,</span>
<span>  partition <span class="op">=</span> <span class="st">".part"</span>,</span>
<span>  thr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max_sens_spec"</span>, <span class="st">"equal_sens_spec"</span>, <span class="st">"max_sorensen"</span><span class="op">)</span>,</span>
<span>  poly <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  inter_order <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula used for model fitting:</span></span>
<span><span class="co">#&gt; pr_ab ~ aet + ppt_jja + pH + awc + depth + landform</span></span>
<span><span class="co">#&gt; Replica number: 1/1</span></span>
<span><span class="co">#&gt; Partition number: 1/5</span></span>
<span><span class="co">#&gt; Partition number: 2/5</span></span>
<span><span class="co">#&gt; Partition number: 3/5</span></span>
<span><span class="co">#&gt; Partition number: 4/5</span></span>
<span><span class="co">#&gt; Partition number: 5/5</span></span>
<span></span>
<span><span class="co"># Build a tuned model using tune_ family functions</span></span>
<span></span>
<span><span class="co"># Prepare the grid object to use in grid argument</span></span>
<span><span class="va">tune_grid</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    mtry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    ntree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">1500</span>, <span class="fl">200</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Build a tuned random forest model</span></span>
<span><span class="va">rf_t1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/tune_raf.html">tune_raf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">abies2</span>,</span>
<span>    response <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>    predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"aet"</span>, <span class="st">"cwd"</span>, <span class="st">"tmin"</span>, <span class="st">"ppt_djf"</span>,</span>
<span>      <span class="st">"ppt_jja"</span>, <span class="st">"pH"</span>, <span class="st">"awc"</span>, <span class="st">"depth"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    predictors_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"landform"</span><span class="op">)</span>,</span>
<span>    partition <span class="op">=</span> <span class="st">".part"</span>,</span>
<span>    grid <span class="op">=</span> <span class="va">tune_grid</span>,</span>
<span>    thr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max_sens_spec"</span>, <span class="st">"equal_sens_spec"</span>, <span class="st">"max_sorensen"</span><span class="op">)</span>,</span>
<span>    metric <span class="op">=</span> <span class="st">"TSS"</span>,</span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Formula used for model fitting:</span></span>
<span><span class="co">#&gt; pr_ab ~ aet + cwd + tmin + ppt_djf + ppt_jja + pH + awc + depth + landform</span></span>
<span><span class="co">#&gt; Tuning model...</span></span>
<span><span class="co">#&gt; Replica number: 1/1</span></span>
<span><span class="co">#&gt; Formula used for model fitting:</span></span>
<span><span class="co">#&gt; pr_ab ~ aet + cwd + tmin + ppt_djf + ppt_jja + pH + awc + depth + landform</span></span>
<span><span class="co">#&gt; Replica number: 1/1</span></span>
<span><span class="co">#&gt; Partition number: 1/5</span></span>
<span><span class="co">#&gt; Partition number: 2/5</span></span>
<span><span class="co">#&gt; Partition number: 3/5</span></span>
<span><span class="co">#&gt; Partition number: 4/5</span></span>
<span><span class="co">#&gt; Partition number: 5/5</span></span>
<span></span>
<span><span class="va">rf_t1</span><span class="op">$</span><span class="va">performance</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 27</span></span></span>
<span><span class="co">#&gt;    mtry ntree model threshold   thr_value n_presences n_absences TPR_mean TPR_sd</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     3   300 raf   max_sens_s…     0.606         700        700    0.924 0.035<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more variables: TNR_mean &lt;dbl&gt;, TNR_sd &lt;dbl&gt;, SORENSEN_mean &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   SORENSEN_sd &lt;dbl&gt;, JACCARD_mean &lt;dbl&gt;, JACCARD_sd &lt;dbl&gt;, FPB_mean &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   FPB_sd &lt;dbl&gt;, OR_mean &lt;dbl&gt;, OR_sd &lt;dbl&gt;, TSS_mean &lt;dbl&gt;, TSS_sd &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   AUC_mean &lt;dbl&gt;, AUC_sd &lt;dbl&gt;, BOYCE_mean &lt;dbl&gt;, BOYCE_sd &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   IMAE_mean &lt;dbl&gt;, IMAE_sd &lt;dbl&gt;</span></span></span>
<span><span class="co"># Note in rf_t1$performance the best model was the one with mtry = 3 and threshold = 'max_sens_spec'</span></span></code></pre></div>
<p>Finally, merge the three sdm performance tables.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merge_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_summarize.html">sdm_summarize</a></span><span class="op">(</span>models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gam_t1</span>, <span class="va">glm_t1</span>, <span class="va">rf_t1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">merge_df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 28</span></span></span>
<span><span class="co">#&gt;   model_ID model threshold      thr_value n_presences n_absences TPR_mean TPR_sd</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1 gam   equal_sens_sp…     0.540         700        700    0.737 0.036<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        1 gam   max_sens_spec      0.530         700        700    0.751 0.046<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        1 gam   max_sorensen       0.359         700        700    0.864 0.058<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        2 glm   equal_sens_sp…     0.523         700        700    0.663 0.058<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        2 glm   max_sens_spec      0.463         700        700    0.803 0.111 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        2 glm   max_sorensen       0.356         700        700    0.876 0.043<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>        3 raf   max_sens_spec      0.606         700        700    0.924 0.035<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more variables: TNR_mean &lt;dbl&gt;, TNR_sd &lt;dbl&gt;, SORENSEN_mean &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   SORENSEN_sd &lt;dbl&gt;, JACCARD_mean &lt;dbl&gt;, JACCARD_sd &lt;dbl&gt;, FPB_mean &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   FPB_sd &lt;dbl&gt;, OR_mean &lt;dbl&gt;, OR_sd &lt;dbl&gt;, TSS_mean &lt;dbl&gt;, TSS_sd &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   AUC_mean &lt;dbl&gt;, AUC_sd &lt;dbl&gt;, BOYCE_mean &lt;dbl&gt;, BOYCE_sd &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   IMAE_mean &lt;dbl&gt;, IMAE_sd &lt;dbl&gt;, mtry &lt;dbl&gt;, ntree &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="raster-interpolation-between-two-time-periods">3. Raster interpolation between two time periods<a class="anchor" aria-label="anchor" href="#raster-interpolation-between-two-time-periods"></a>
</h3>
<p>This function is useful for calculating projected suitability values
between two time periods with simple interpolation using two raster
objects with suitability values. This is useful if, for example, a SDM
has been projected to a future or past time period (using maps of
predictor variables, such as climate variables, for different time
periods), and the user requires an estimate of suitability for
intermediate time periods. For example this may be needed for input into
other types of models for risk analysis.</p>
<p>This function returns a SpatRaster if dir_save is used as NULL.
However, if the user specifies dir_save, the function will save the
interpolated raster files in a given directory.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/suit_time_step.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span><span class="va">abma</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">abma</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/interp_data-1.png" width="576"></p>
<p>This function will create an object of interpolated values with n
annual layers ranging from the initial to final year. The resolution and
dimensions of the result object will remain the same as the initial and
final maps. In this example, there are nine annual (2011-2019)
interpolated maps generated from the initial (2010) and final (2020)
prediction maps. A cell with a starting value of 1 and and ending value
of 0 would be changed in increments of (1-0)/((2020-2010)-1), and given
interpolated values of 0.9, 0.8, 0.7…0.1</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interp.html">interp</a></span><span class="op">(</span></span>
<span>  r1 <span class="op">=</span> <span class="va">abma</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="co"># set the raster of initial year</span></span>
<span>  r2 <span class="op">=</span> <span class="va">abma</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="co"># set the raster of final year</span></span>
<span>  y1 <span class="op">=</span> <span class="fl">2010</span>, <span class="co"># set the numeric initial year</span></span>
<span>  y2 <span class="op">=</span> <span class="fl">2020</span>, <span class="co"># set the numeric final year</span></span>
<span>  rastername <span class="op">=</span> <span class="st">"Abies"</span>,</span>
<span>  dir_save <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Layers in the abma SpatRaster</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">abma</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "current" "future"</span></span>
<span><span class="co"># plot(abma)</span></span>
<span></span>
<span><span class="co"># Layers in the int SpatRaster</span></span>
<span><span class="va">int</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 11  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varnames    : suit_time_step </span></span>
<span><span class="co">#&gt;               suit_time_step </span></span>
<span><span class="co">#&gt;               suit_time_step </span></span>
<span><span class="co">#&gt;               ...</span></span>
<span><span class="co">#&gt; names       : Abies_2010, Abies_2011, Abies_2012, Abies_2013, Abies_2014, Abies_2015, ... </span></span>
<span><span class="co">#&gt; min values  :  0.0000000,  0.0000000,  0.0000000,  0.0000000,  0.0000000,  0.0000000, ... </span></span>
<span><span class="co">#&gt; max values  :  0.9756107,  0.9606077,  0.9504615,  0.9440073,  0.9442941,  0.9463548, ...</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/interp-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="measure-model-extrapolation">4. Measure model extrapolation<a class="anchor" aria-label="anchor" href="#measure-model-extrapolation"></a>
</h3>
<p>This function measures the extent of model extrapolation by comparing
data used for modeling calibration and the area for model projection
using the approach proposed by Velazco et al., in prep.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">spp</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the unique values for species</span></span>
<span><span class="va">spp</span><span class="op">$</span><span class="va">species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sp1" "sp2" "sp3"</span></span>
<span></span>
<span><span class="co"># Subset spp data into a tibble only with coordinates for sp3 and pr_ab == 1</span></span>
<span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp3"</span>, <span class="va">pr_ab</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define accessible area for sp3 based on a buffer with around each point that is related to dispersal ability or some other ecological criterion</span></span>
<span><span class="va">ca</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span></span>
<span>    <span class="va">sp</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"buffer"</span>, width <span class="op">=</span> <span class="fl">30000</span><span class="op">)</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the SpatRaster, occurrences and accessible area</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">$</span><span class="va">CFP_1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/measure_extrap-1.png" width="576"></p>
<p>The accessible area defines calibration area used to extract the
environmental conditions</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">somevar_ca</span> <span class="op">&lt;-</span> <span class="va">somevar</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">ca</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">ca</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot environmental conditions of the calibration area</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">somevar_ca</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/get_env-1.png" width="576"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">xp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/extra_eval.html">extra_eval</a></span><span class="op">(</span></span>
<span>    training_data <span class="op">=</span> <span class="va">somevar_ca</span>,</span>
<span>    projection_data <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>    n_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    aggreg_factor <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the SpatRaster object with the extrapolation values measured in percentage</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xp</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/get_env-2.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="correction-of-suitability-based-on-extrapolation">5. Correction of suitability based on extrapolation<a class="anchor" aria-label="anchor" href="#correction-of-suitability-based-on-extrapolation"></a>
</h3>
</div>
<div class="section level3">
<h3 id="create-spatial-predictor-variables-to-reduce-overprediction-of-species-distribution-models">6. Create spatial predictor variables to reduce overprediction of
species distribution models<a class="anchor" aria-label="anchor" href="#create-spatial-predictor-variables-to-reduce-overprediction-of-species-distribution-models"></a>
</h3>
<p>This function creates geographical predictor variables that, together
with environmental variables, can be used to construct constrained
species distribution models. This function returns a SpatRaster object,
which have to be used together with environmental variables to construct
species distribution models. The ‘xy’ approach creates a single pair of
raster layers that can be used for all species that share the same study
region. Otherwise, ‘cml’, ‘min’, and ‘ker’ create a species-specific
raster layer.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spp"</span><span class="op">)</span></span>
<span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the presences of one species (sp3)</span></span>
<span><span class="va">occ</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp3"</span>, <span class="va">pr_ab</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select a raster layer to be used as a basic raster</span></span>
<span><span class="va">a_variable</span> <span class="op">&lt;-</span> <span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">a_variable</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occ</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_priori-1.png" width="576"></p>
<p>Next, use different methods according to your data.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use xy method</span></span>
<span><span class="va">m_xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msdm_priori.html">msdm_priori</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">occ</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"xy"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">a_variable</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_xy</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_xy-1.png" width="576"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Explore the object. This method assumes that spatial structure can partially explain species distribution (Bahn &amp; Mcgill, 2007). Therefore, the result are two raster layers containing the latitude and longitude of pixels, respectively. This method could be used for all species set that share the same study area region.</span></span>
<span><span class="va">m_xy</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 2  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varnames    : somevar </span></span>
<span><span class="co">#&gt;               somevar </span></span>
<span><span class="co">#&gt; names       :  msdm_lon,  msdm_lat </span></span>
<span><span class="co">#&gt; min values  : -370850.8, -601978.3 </span></span>
<span><span class="co">#&gt; max values  :  368139.2,  448861.7</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_cml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msdm_priori.html">msdm_priori</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">occ</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"cml"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">a_variable</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_cml</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_cml-1.png" width="576"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Explore the object. This method assumes that pixels closer to presences are likely included in species distributions. The results is a raster layer containing the sum of euclidean geographic distances from each pixel to all occurrences of a species.</span></span>
<span><span class="va">m_cml</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : somevar </span></span>
<span><span class="co">#&gt; name        : msdm_cml </span></span>
<span><span class="co">#&gt; min value   :        0 </span></span>
<span><span class="co">#&gt; max value   :        1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="methods-to-correct-overprediction-of-species-distribution-models-based-on-occurrences-and-suitability-patterns">7. Methods to correct overprediction of species distribution models
based on occurrences and suitability patterns<a class="anchor" aria-label="anchor" href="#methods-to-correct-overprediction-of-species-distribution-models-based-on-occurrences-and-suitability-patterns"></a>
</h3>
<p>These methods are designed to reduce overprediction of species
distribution models based on an a posteriori method (see Mendes et al
2020), i.e., the combination of the patterns of species occurrences and
predicted suitability.</p>
<p>First, prepare the data</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spp"</span><span class="op">)</span></span>
<span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare data for modeling a species</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">occ</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># filter using only sp2</span></span>
<span>  <span class="fu"><a href="../reference/sdm_extract.html">sdm_extract</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">.</span>, x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    env_layer <span class="op">=</span> <span class="va">somevar</span>, filter_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># extract variables values from the raster layer</span></span>
<span>  <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span><span class="va">.</span>,</span>
<span>    pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kfold"</span>, folds <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># add columns with partition</span></span>
<span><span class="co">#&gt; 6 rows were excluded from database because NAs were found</span></span></code></pre></div>
<p>Next, we fit and predict a model</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_glm.html">fit_glm</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">occ</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span>,</span>
<span>  partition <span class="op">=</span> <span class="st">".part"</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"equal_sens_spec"</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula used for model fitting:</span></span>
<span><span class="co">#&gt; pr_ab ~ CFP_1 + CFP_2 + CFP_3 + CFP_4 + I(CFP_1^2) + I(CFP_2^2) + I(CFP_3^2) + I(CFP_4^2)</span></span>
<span><span class="co">#&gt; Replica number: 1/1</span></span>
<span><span class="co">#&gt; Partition number: 1/10</span></span>
<span><span class="co">#&gt; Partition number: 2/10</span></span>
<span><span class="co">#&gt; Partition number: 3/10</span></span>
<span><span class="co">#&gt; Partition number: 4/10</span></span>
<span><span class="co">#&gt; Partition number: 5/10</span></span>
<span><span class="co">#&gt; Partition number: 6/10</span></span>
<span><span class="co">#&gt; Partition number: 7/10</span></span>
<span><span class="co">#&gt; Partition number: 8/10</span></span>
<span><span class="co">#&gt; Partition number: 9/10</span></span>
<span><span class="co">#&gt; Partition number: 10/10</span></span></code></pre></div>
<p>Next, let’s predict this model and plot it in a map</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predict this model</span></span>
<span><span class="va">m_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_predict.html">sdm_predict</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">m_glm</span>, pred <span class="op">=</span> <span class="va">somevar</span>, thr <span class="op">=</span> <span class="cn">NULL</span>, con_thr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Predicting individual models</span></span>
<span></span>
<span><span class="co"># Predicting individual models</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_post_predict-1.png" width="576"></p>
<p>Finally, perform correction to avoid models overpredictions.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using mcp method. The Minimum Convex Polygon (mcp) method excludes from SDMs climate suitable pixels that do not intercept a minimum convex polygon, with interior angles smaller than 180, enclosing all occurrences of a species.</span></span>
<span><span class="va">m_mcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msdm_posteriori.html">msdm_posteriori</a></span><span class="op">(</span></span>
<span>  records <span class="op">=</span> <span class="va">occ</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"mcp"</span>,</span>
<span>  cont_suit <span class="op">=</span> <span class="va">m_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"equal_sens_spec"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_mcp</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_post-1.png" width="576"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Using bmcp method. The Buffered Minimum Convex Polygon (bmcp) method is similar to the 'mcp' except by the inclusion of a buffer zone surrounding minimum convex polygons.</span></span>
<span><span class="va">m_bmcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msdm_posteriori.html">msdm_posteriori</a></span><span class="op">(</span></span>
<span>  records <span class="op">=</span> <span class="va">occ</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"bmcp"</span>,</span>
<span>  cont_suit <span class="op">=</span> <span class="va">m_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"equal_sens_spec"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">30000</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_bmcp</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_post-2.png" width="576"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Using obr method. The Occurrences Based Restriction (obr) method assumes that suitable patches intercepting species occurrences are more likely a part of species distributions than suitable patches that do not intercept any occurrence.</span></span>
<span><span class="va">m_obr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msdm_posteriori.html">msdm_posteriori</a></span><span class="op">(</span></span>
<span>  records <span class="op">=</span> <span class="va">occ</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"obr"</span>,</span>
<span>  cont_suit <span class="op">=</span> <span class="va">m_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"equal_sens_spec"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_obr</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_post-3.png" width="576"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Using pres method. The only occurrences based restriction (pres) method only retains those pixels in suitability patches intercepting occurrences.</span></span>
<span><span class="va">m_pres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msdm_posteriori.html">msdm_posteriori</a></span><span class="op">(</span></span>
<span>  records <span class="op">=</span> <span class="va">occ</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"pres"</span>,</span>
<span>  cont_suit <span class="op">=</span> <span class="va">m_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"equal_sens_spec"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_pres</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_post-4.png" width="576"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Using lq method. The Lower Quantile (lq) method works whenever a suitable pixel is within a k patch, i.e., not within this lower quartile, the suitability of the pixel is reduced to zero. This means that 75% of k patches were withdrawn from the model.</span></span>
<span><span class="va">m_lq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msdm_posteriori.html">msdm_posteriori</a></span><span class="op">(</span></span>
<span>  records <span class="op">=</span> <span class="va">occ</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"lq"</span>,</span>
<span>  cont_suit <span class="op">=</span> <span class="va">m_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  thr <span class="op">=</span> <span class="st">"equal_sens_spec"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_lq</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_post_modeling_files/figure-html/msdm_post-5.png" width="576"></p>
<p>#=========#=========#=========#=========#=========#=========#=========#</p>
<p><strong>Vignette still under construction and changes</strong></p>
<p>#=========#=========#=========#=========#=========#=========#=========#</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Santiago J.E. Velazco, Brooke Rose, André F.A. Andrade, Ignacio Minoli, Janet Franklin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
