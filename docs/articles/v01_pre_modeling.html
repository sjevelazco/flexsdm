<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>flexsdm: Overview of Pre-modeling functions • flexsdm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="flexsdm: Overview of Pre-modeling functions">
<meta name="google-site-verification" content="gcou8tqRTwNjZ_Mf1kbFgAzzUcY3OF-JB2sPRPTA56I">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">flexsdm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01_pre_modeling.html">1. Overview of Pre-modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v02_modeling.html">2. Overview of Modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v03_post_modeling.html">3. Overview of Post-modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v04_Red_fir_example.html">4. An example with Red Fir</a></li>
    <li><a class="dropdown-item" href="../articles/v05_Rare_species_example.html">5. Modeling a rare species</a></li>
    <li><a class="dropdown-item" href="../articles/v06_Extrapolation_example.html">6. Tools to explore extrapolation in SDMs</a></li>
    <li><a class="dropdown-item" href="../articles/v07_Complete_workflow.html">7. Modeling workflow for several species</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/pkg_citation.html">Citations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/pkg_citation.html">Citations</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
<li class="nav-item"><a class="nav-link" href="https://sjevelazco.github.io/flexsdm" aria-label="GitHub">GitHub</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sjevelazco/flexsdm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>flexsdm: Overview of Pre-modeling functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sjevelazco/flexsdm/blob/HEAD/vignettes/v01_pre_modeling.Rmd" class="external-link"><code>vignettes/v01_pre_modeling.Rmd</code></a></small>
      <div class="d-none name"><code>v01_pre_modeling.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Species distribution modeling (SDM) has become a standard tool in
many research areas, including ecology, conservation biology,
biogeography, paleobiogeography, and epidemiology. SDM is an active area
of theoretical and methodological research. The <em>flexsdm</em> package
provides users the ability to manipulate and parameterize models in a
variety of ways that meet their unique research needs.</p>
<p>This flexibility enables users to define their own complete or
partial modeling procedure specific for their modeling situation (e.g.,
number of variables, number of records, different algorithms and
ensemble methods, algorithms tuning, etc.).</p>
<p>In this vignette, users will learn about the first set of functions
in the <em>flexsdm</em> package that fall under the “pre-modeling”
umbrella (see below for full list).</p>
<p><strong>pre-modeling functions</strong></p>
<ul>
<li><p>calib_area() Delimit calibration area for constructing species
distribution models</p></li>
<li><p>correct_colinvar() Collinearity reduction for predictors</p></li>
<li><p>env_outliers() Integration of outliers detection methods in
environmental space</p></li>
<li><p>part_random() Data partitioning for training and testing
models</p></li>
<li><p>part_sblock() Spatial block cross-validation</p></li>
<li><p>part_sband() Spatial band cross-validation</p></li>
<li><p>part_senv() Environmental cross-validation</p></li>
<li><p>plot_res() Plot different resolutions to be used in
part_sblock</p></li>
<li><p>get_block() Transform a spatial partition layer to the same
spatial properties as the environmental variables</p></li>
<li><p>sample_background() Sample background points</p></li>
<li><p>sample_pseudoabs() Sample pseudo-absence</p></li>
<li><p>sdm_directory() Create directories for saving the outputs of
flexsdm</p></li>
<li><p>sdm_extract() Extract environmental data based on x and y
coordinates</p></li>
<li><p>occfilt_env() Perform environmental filtering on species
occurrences</p></li>
<li><p>occfilt_geo() Perform geographical filtering on species
occurrences</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>First, install the flexsdm package. You can install the released
version of <em>flexsdm</em> from <a href="https://github.com/sjevelazco/flexsdm" class="external-link">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::install_github('sjevelazco/flexsdm')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjevelazco.github.io/flexsdm">flexsdm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.60</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'terra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:knitr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     spin</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="project-directory-setup">Project Directory Setup<a class="anchor" aria-label="anchor" href="#project-directory-setup"></a>
</h2>
<p>When building SDM’s, organizing folders (directories) for a project
will save time and confusion. The project directory is the main project
folder where you will store all of the relevant data and results for
your current project. Now, let’s create a project directory where your
initial data and the model results will be stored. The function
sdm_directory() can do this for you, based on the types of model
algorithms you want to use and/or the types of projections you would
like to make. First decide where on your computer you would like to
store the inputs and outputs of the project (this will be the main
directory) and then use dir.create() to create that main directory.
Next, specify whether or not you want to include folders for
projections, calibration areas, algorithms, ensembles, and
thresholds.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_project</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"flex_sdm_project"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">my_project</span><span class="op">)</span></span>
<span></span>
<span><span class="va">project_directory</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_directory.html">sdm_directory</a></span><span class="op">(</span></span>
<span>  main_dir <span class="op">=</span> <span class="va">my_project</span>,</span>
<span>  projections <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calibration_area <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fit_max"</span>, <span class="st">"tune_raf"</span><span class="op">)</span>,</span>
<span>  ensemble <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span><span class="op">)</span>,</span>
<span>  threshold <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  return_vector <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-species-occurrence-and-background-data">Data, species occurrence and background data<a class="anchor" aria-label="anchor" href="#data-species-occurrence-and-background-data"></a>
</h2>
<p>In this tutorial, we will be using species occurrences that are
available through the <em>flexsdm</em> package. The “spp” example
dataset includes pr_ab column (presence = 1, and absence = 0), and
location columns (x, y). You can load the “spp” data into your local R
environment by using the code below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spp"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spp</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,150 × 4</span></span></span>
<span><span class="co">#&gt;    species        x        y pr_ab</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> sp1       -<span style="color: #BB0000; text-decoration: underline;">5</span><span style="color: #BB0000;">541.</span> -<span style="color: #BB0000; text-decoration: underline;">145</span><span style="color: #BB0000;">138.</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> sp1      -<span style="color: #BB0000; text-decoration: underline;">51</span><span style="color: #BB0000;">981.</span>   <span style="text-decoration: underline;">16</span>322.     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">269</span><span style="color: #BB0000;">871.</span>   <span style="text-decoration: underline;">69</span>512.     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sp1      -<span style="color: #BB0000; text-decoration: underline;">96</span><span style="color: #BB0000;">261.</span>  -<span style="color: #BB0000; text-decoration: underline;">32</span><span style="color: #BB0000;">008.</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> sp1      <span style="text-decoration: underline;">269</span>589. -<span style="color: #BB0000; text-decoration: underline;">566</span><span style="color: #BB0000;">338.</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> sp1       <span style="text-decoration: underline;">29</span>829. -<span style="color: #BB0000; text-decoration: underline;">328</span><span style="color: #BB0000;">468.</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">152</span><span style="color: #BB0000;">691.</span>  <span style="text-decoration: underline;">393</span>782.     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">195</span><span style="color: #BB0000;">081.</span>  <span style="text-decoration: underline;">253</span>652.     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> sp1        -<span style="color: #BB0000;">951.</span> -<span style="color: #BB0000; text-decoration: underline;">277</span><span style="color: #BB0000;">978.</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> sp1      <span style="text-decoration: underline;">145</span>929. -<span style="color: #BB0000; text-decoration: underline;">271</span><span style="color: #BB0000;">498.</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,140 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="geographic-region">Geographic region<a class="anchor" aria-label="anchor" href="#geographic-region"></a>
</h2>
<p>Our species occurrences are located in the California Floristic
Province (far western USA). The “regions” dataset can be used to
visualize the study area in geographic space.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/regions.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span></span></code></pre></div>
<p>How are the points distributed across our study area?</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">spp</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">spp</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/map-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="calibration-area">Calibration area<a class="anchor" aria-label="anchor" href="#calibration-area"></a>
</h2>
<p>An important decision in SDM is how to delimit your model’s
calibration area, or the geographic space you will use to train your
model(s). Choice of calibration area affects other modeling steps,
including sampling pseudo-absence and background points, performance
metrics, and the geographic patterns of habitat suitability. You would
not want to train an SDM using the entire extent of the United States if
you are interested in the geographic distribution and environmental
controls of a rare plant species that is only found on mountaintops in
the Sierra Nevada, California!</p>
<p>Let’s use presence locations for one species in this exercise.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spp1</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pr_ab</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">pr_ab</span><span class="op">)</span></span></code></pre></div>
<p>The calib_area() function offers three methods for defining a
calibration area: buffer, mcp, bmcp, and mask. We will briefly go over
each.</p>
<div class="section level3">
<h3 id="buffer">1. Buffer<a class="anchor" aria-label="anchor" href="#buffer"></a>
</h3>
<p>Here the calibration area is defined using buffers around presence
points. User’s can specify the distance around points using the “width”
argument. The buffer width value is interpreted in m if the CRS has a
longitude/latitude, or in map units in other cases.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">regions</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "+proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs"</span></span>
<span></span>
<span><span class="va">ca_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"buffer"</span>, width <span class="op">=</span> <span class="fl">40000</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">regions</span>, main <span class="op">=</span> <span class="st">"Buffer method"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca_1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">spp1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/buffer%20method-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="minimum-convex-polygon">2. Minimum convex polygon<a class="anchor" aria-label="anchor" href="#minimum-convex-polygon"></a>
</h3>
<p>The minimum convex polygon (mcp) method produces a much simpler
shape.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ca_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcp"</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">regions</span>, main <span class="op">=</span> <span class="st">"Minimum convex polygon method"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca_2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">spp1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/mcp%20method-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="buffered-minimum-convex-polygon">3. Buffered minimum convex polygon<a class="anchor" aria-label="anchor" href="#buffered-minimum-convex-polygon"></a>
</h3>
<p>You can also create a buffer around the minimum convex polygon.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ca_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bmcp"</span>, width <span class="op">=</span> <span class="fl">40000</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">regions</span>, main <span class="op">=</span> <span class="st">"Buffered minimum convex polygon"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca_3</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">spp1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/bmcp%20method-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="mask">4. Mask<a class="anchor" aria-label="anchor" href="#mask"></a>
</h3>
<p>The mask method allows polygons to be selected that intersect with
your species locations to delineate the calibration area. This is useful
if you expect species distributions to be associated with ecologically
significant (and mapped) ecoregions, or are interested in distributions
within political boundaries. We will use a random set of polygons named
“clusters” to illustrate the mask method. The original polygons are on
the left and the polygons that contain points (our “mask” calibration
area) are on the right.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/clusters.shp"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ca_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mask"</span>, <span class="va">clusters</span>, <span class="st">"clusters"</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">clusters</span>, main <span class="op">=</span> <span class="st">"Original polygons"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca_4</span>, main <span class="op">=</span> <span class="st">"Polygons with points (mask)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">spp1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/mask%20method-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="reducing-collinearity-among-the-predictors">Reducing collinearity among the predictors<a class="anchor" aria-label="anchor" href="#reducing-collinearity-among-the-predictors"></a>
</h2>
<p>Predictor collinearity is a common issue for SDMs, which can lead to
model overfitting and inaccurate tests of significance for predictors
(De Marco &amp; Nóbrega, 2018; Dormann et al., 2013).</p>
<div class="section level3">
<h3 id="environmental-predictors">Environmental predictors<a class="anchor" aria-label="anchor" href="#environmental-predictors"></a>
</h3>
<p>Here we will use four climatic variables available in the
<em>flexsdm</em> package: actual evapotranspiration (CFP_1), climatic
water deficit (CFP_2), maximum temperature of the warmest month (CFP_3),
and minimum temperature of the coldest month (CFP_4).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aet"</span>, <span class="st">"cwd"</span>, <span class="st">"tmx"</span>, <span class="st">"tmn"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/env%20data-1.png" width="576"></p>
<p>The relationship between different environmental variables can be
visualized with the pairs() function from the <em>terra</em> package.
Several of our variables are highly correlated (.89 for predictors tmx
and tmn).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/pairs%20plot-1.png" width="576"></p>
<p>So how can we correct for or reduce this collinearity? The function
correct_colinvar() has four methods to deal with collinearity: pearson,
vif, pca, and fa. Each method returns 1) a raster object (SpatRaster)
with the selected predictors and 2) other useful outputs relevant to
each method. These functions should be used as supplementary tools, as
predictor selection in SDMs is complicated and ultimately should be
based on the relationship between the environment and species’ biology.
With that being said, these functions offer options for exploring the
relationships between predictor variables that can aid in the predictor
selection process.</p>
<p>All collinearity analysis could be based on entire cells of
environmental rasters or just using those cells with species points used
to construct the models (see <code>details</code> and
<code>based_on_points</code> argument of <code>correct_colivar()</code>
function). Use or not <code>based_on_points</code> approach could yield
different results.</p>
<p>Let’s look at each method:</p>
</div>
<div class="section level3">
<h3 id="pearson-correlation">1. Pearson correlation<a class="anchor" aria-label="anchor" href="#pearson-correlation"></a>
</h3>
<p>This method returns three objects 1) SpatRaster with environmental
variables with a correlation below a given threshold (the default is
0.7), 2) the names of the variables that had a correlation above the
given threshold and were “removed” from the environmental data, and 3) a
correlation matrix of all of the environmental variables. However, we
strongly urge users to use this information along with knowledge about
specific species-environment relationships to select
ecologically-relevant predictors for their SDMs. For example, here, we
are modeling the distribution of a plant species in a water-limited
Mediterranean-type ecosystem, so we may want to include BOTH climatic
water deficit (cwd) and actual evapotranspiration (aet). Despite being
highly correlated, these variables capture water availability and
evaporative demand, respectively (Stephenson 1998). Additionally,
minimum absolute temperature strongly controls vegetation distributions
(Woodward, Lomas, and Kelly 2004), so we would select tmn (minimum
temperature of the coldest month) in this example.</p>
<p>For references, see:</p>
<div class="section level4">
<h4 id="stephenson-n--1998--actual-evapotranspiration-and-deficit-biologically-meaningful-correlates-of-vegetation-distribution-across-spatial-scales--journal-of-biogeography-25855870-">1. Stephenson, N. 1998. Actual evapotranspiration and deficit:
biologically meaningful correlates of vegetation distribution across
spatial scales. Journal of biogeography 25:855–870.<a class="anchor" aria-label="anchor" href="#stephenson-n--1998--actual-evapotranspiration-and-deficit-biologically-meaningful-correlates-of-vegetation-distribution-across-spatial-scales--journal-of-biogeography-25855870-"></a>
</h4>
</div>
<div class="section level4">
<h4 id="woodward-f--i--m--r--lomas-and-c--k--kelly--2004--global-climate-and-the-distribution-of-plant-biomes--philosophical-transactions-of-the-royal-society-of-london--series-b-biological-sciences-35914651476-">2. Woodward, F. I., M. R. Lomas, and C. K. Kelly. 2004. Global
climate and the distribution of plant biomes. Philosophical transactions
of the Royal Society of London. Series B, Biological sciences
359:1465–1476.<a class="anchor" aria-label="anchor" href="#woodward-f--i--m--r--lomas-and-c--k--kelly--2004--global-climate-and-the-distribution-of-plant-biomes--philosophical-transactions-of-the-royal-society-of-london--series-b-biological-sciences-35914651476-"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pearson_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_colinvar.html">correct_colinvar</a></span><span class="op">(</span><span class="va">somevar</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, th <span class="op">=</span> <span class="st">"0.7"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pearson_var</span><span class="op">$</span><span class="va">cor_table</span></span>
<span><span class="co">#&gt;           aet       cwd       tmx       tmn</span></span>
<span><span class="co">#&gt; aet 0.0000000 0.7689893 0.7924813 0.7845401</span></span>
<span><span class="co">#&gt; cwd 0.7689893 0.0000000 0.4168956 0.5881831</span></span>
<span><span class="co">#&gt; tmx 0.7924813 0.4168956 0.0000000 0.7323259</span></span>
<span><span class="co">#&gt; tmn 0.7845401 0.5881831 0.7323259 0.0000000</span></span>
<span><span class="va">pearson_var</span><span class="op">$</span><span class="va">cor_variables</span></span>
<span><span class="co">#&gt; $aet</span></span>
<span><span class="co">#&gt; [1] "cwd" "tmx" "tmn"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cwd</span></span>
<span><span class="co">#&gt; [1] "aet"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tmx</span></span>
<span><span class="co">#&gt; [1] "aet" "tmn"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tmn</span></span>
<span><span class="co">#&gt; [1] "aet" "tmx"</span></span>
<span></span>
<span><span class="va">chosen_variables</span> <span class="op">&lt;-</span> <span class="va">somevar</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cwd"</span>, <span class="st">"aet"</span>, <span class="st">"tmn"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="variance-inflation-factor">2. Variance inflation factor<a class="anchor" aria-label="anchor" href="#variance-inflation-factor"></a>
</h3>
<p>This method removes the predictors with a variance inflation factor
higher than the chosen threshold. Again, users can specify a threshold
(the default is 10). This method retains the predictors aet, tmx, and
tmn and removes cwd. The output for this method matches what is produced
by the pearson method: 1) environmental layer of retained variables, 2)
a list of removed variables, and 3) a correlation matrix of all
variables.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vif_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_colinvar.html">correct_colinvar</a></span><span class="op">(</span><span class="va">somevar</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vif"</span>, th <span class="op">=</span> <span class="st">"10"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vif_var</span><span class="op">$</span><span class="va">env_layer</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 4  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source      : somevar.tif </span></span>
<span><span class="co">#&gt; names       :      aet,      cwd,       tmx,        tmn </span></span>
<span><span class="co">#&gt; min values  :    0.000, -9.39489,  22.44685,  0.2591429 </span></span>
<span><span class="co">#&gt; max values  : 1357.865, 14.20047, 614.69125, 64.3747588</span></span>
<span><span class="va">vif_var</span><span class="op">$</span><span class="va">removed_variables</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="va">vif_var</span><span class="op">$</span><span class="va">vif_table</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   Variables   VIF</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> aet        7.62</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cwd        3.29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> tmx        3.95</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> tmn        2.89</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="principal-component-analysis">3. Principal component analysis<a class="anchor" aria-label="anchor" href="#principal-component-analysis"></a>
</h3>
<p>Finally, the “pca” method performs a principal components analysis on
the predictors and returns the axis that accounts for 95% of the total
variance in the system. This method returns 1) a SpatRaster object with
selected environmental variables, 2) a matrix with the coefficients of
principal components for predictors, and 3) a tibble with the cumulative
variance explained in selected principal components.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_colinvar.html">correct_colinvar</a></span><span class="op">(</span><span class="va">somevar</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pca_var</span><span class="op">$</span><span class="va">env_layer</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 558, 394, 3  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       :       PC1,       PC2,       PC3 </span></span>
<span><span class="co">#&gt; min values  : -8.453273, -4.260147, -1.525085 </span></span>
<span><span class="co">#&gt; max values  :  2.827164,  3.337545,  4.342864</span></span>
<span><span class="va">pca_var</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   variable    PC1     PC2    PC3     PC4</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> aet       0.550 -<span style="color: #BB0000;">0.072</span><span style="color: #BB0000; text-decoration: underline;">2</span>  0.296 -<span style="color: #BB0000;">0.778</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cwd       0.450 -<span style="color: #BB0000;">0.777</span>   0.103  0.429 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> tmx      -<span style="color: #BB0000;">0.485</span> -<span style="color: #BB0000;">0.594</span>  -<span style="color: #BB0000;">0.450</span> -<span style="color: #BB0000;">0.459</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> tmn      -<span style="color: #BB0000;">0.511</span> -<span style="color: #BB0000;">0.198</span>   0.836 -<span style="color: #BB0000;">0.024</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="va">pca_var</span><span class="op">$</span><span class="va">cumulative_variance</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;      PC  cvar</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 0.764</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 0.915</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 0.979</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="factorial-analysis">4. Factorial analysis<a class="anchor" aria-label="anchor" href="#factorial-analysis"></a>
</h3>
<p>Selecting the “fa” method performs a factorial analysis to reduce
dimensionality and selects the predictor(s) with the highest correlation
to each axis. The outputs for this method are similar to those produced
by the ‘pca’ method.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fa_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_colinvar.html">correct_colinvar</a></span><span class="op">(</span>env_layer <span class="op">=</span> <span class="va">somevar</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fa"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fa_var</span><span class="op">$</span><span class="va">env_layer</span></span>
<span><span class="va">fa_var</span><span class="op">$</span><span class="va">number_factors</span></span>
<span><span class="va">fa_var</span><span class="op">$</span><span class="va">removed_variables</span></span>
<span><span class="va">fa_var</span><span class="op">$</span><span class="va">uniqueness</span></span>
<span><span class="va">fa_var</span><span class="op">$</span><span class="va">loadings</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comments">5. Comments<a class="anchor" aria-label="anchor" href="#comments"></a>
</h3>
<p>In <em>flexsdm</em> it is also possible to restrict the cell used to
perform collinearity reduction analysis to a geographical area smaller
than the full extent of environmental variables. See the
‘restric_to_region’ and ‘restric_pca_proj’ in <a href="https://sjevelazco.github.io/flexsdm/reference/correct_colinvar.html">correct_colinvar</a>
and the examples with alternative PCA given in this function help.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-filtering">Data filtering<a class="anchor" aria-label="anchor" href="#data-filtering"></a>
</h2>
<p>Sample bias in species occurrence data is a common issue in
ecological studies and filtering the occurrence data can reduce some of
this bias. <em>flexsdm</em> provides two functions for different types
of filtering, based on geographical or environmental “thinning”,
randomly removing points where they are dense (oversampling) in
geographical or environmental space. This can improve model performance
and reduce redundancy in your data.</p>
<div class="section level3">
<h3 id="environmental-filtering">Environmental filtering<a class="anchor" aria-label="anchor" href="#environmental-filtering"></a>
</h3>
<p>The function <code><a href="../reference/occfilt_env.html">occfilt_env()</a></code>, which performs environmental
filtering on species occurrence data. This method basically reduces
environmental redundancy in your data and is based on methods outlined
in Valera et al. (2014). However, this function is unique to
<em>flexsdm</em>, as it is able to use any number of environmental
dimensions and does not perform a PCA before filtering. In this example,
we will use our original environmental data (somevar) and occurrence
data for a single species (spp1). For filtering occurrences, it is
important that each row in the species data has its own unique code
(example: idd). This function also gives the user the option of
specifying the number classes used to split each environmental
condition. Here we will explore the results using 5, 8, and 12 bins.
Increasing the number of bins increases the number of occurrence points
retained.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spp1</span><span class="op">$</span><span class="va">idd</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">spp1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filt_env5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_env.html">occfilt_env</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"idd"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  nbins <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting values from raster ...</span></span>
<span><span class="co">#&gt; 12 records were removed because they have NAs for some variables</span></span>
<span><span class="co">#&gt; Number of unfiltered records: 238</span></span>
<span><span class="co">#&gt; Number of filtered records: 57</span></span>
<span></span>
<span><span class="va">filt_env8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_env.html">occfilt_env</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"idd"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  nbins <span class="op">=</span> <span class="fl">8</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting values from raster ...</span></span>
<span><span class="co">#&gt; 12 records were removed because they have NAs for some variables</span></span>
<span><span class="co">#&gt; Number of unfiltered records: 238</span></span>
<span><span class="co">#&gt; Number of filtered records: 112</span></span>
<span></span>
<span><span class="va">filt_env12</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_env.html">occfilt_env</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"idd"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  nbins <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting values from raster ...</span></span>
<span><span class="co">#&gt; 12 records were removed because they have NAs for some variables</span></span>
<span><span class="co">#&gt; Number of unfiltered records: 238</span></span>
<span><span class="co">#&gt; Number of filtered records: 173</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Original occurrence data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">spp1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Filtering with 5 bins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">filt_env5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Filtering with 8 bins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">filt_env8</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Filtering with 12 bins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">filt_env12</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/env%20occurrence%20filtering-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="geographical-filtering">Geographical filtering<a class="anchor" aria-label="anchor" href="#geographical-filtering"></a>
</h3>
<p>Next, we will look at <code><a href="../reference/occfilt_geo.html">occfilt_geo()</a></code>, which has three
alternatives to determine the distance threshold between a pair of
points: “moran” determines the threshold as the distance between points
that minimizes the spatial autocorrelation in occurrence data;
“cellsize” filters occurrences based on the resolution of the predictors
(or a specified coarser resolution); finally, “determined” allows users
to manually determine the distance threshold.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filt_geo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_geo.html">occfilt_geo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"moran"</span><span class="op">)</span>,</span>
<span>  prj <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting values from raster ...</span></span>
<span><span class="co">#&gt; 16 records were removed because they have NAs for some variables</span></span>
<span><span class="co">#&gt; Number of unfiltered records: 234</span></span>
<span><span class="co">#&gt; Moran's I threshold closest to the supplied value: 0.099</span></span>
<span><span class="co">#&gt; Distance threshold (km) : 334.908</span></span>
<span><span class="co">#&gt; Number of filtered records: 4</span></span>
<span></span>
<span><span class="va">filt_geo2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_geo.html">occfilt_geo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cellsize"</span>, factor <span class="op">=</span> <span class="st">"3"</span><span class="op">)</span>, <span class="co"># coarser resolution than the provided raster</span></span>
<span>  prj <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting values from raster ...</span></span>
<span><span class="co">#&gt; 16 records were removed because they have NAs for some variables</span></span>
<span><span class="co">#&gt; Number of unfiltered records: 234</span></span>
<span><span class="co">#&gt; Factor: x3</span></span>
<span><span class="co">#&gt; Distance threshold (km): 4.617</span></span>
<span><span class="co">#&gt; Number of filtered records: 212</span></span>
<span></span>
<span><span class="va">filt_geo3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_geo.html">occfilt_geo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"defined"</span>, d <span class="op">=</span> <span class="st">"30"</span><span class="op">)</span>,</span>
<span>  prj <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting values from raster ...</span></span>
<span><span class="co">#&gt; 16 records were removed because they have NAs for some variables</span></span>
<span><span class="co">#&gt; Number of unfiltered records: 234</span></span>
<span><span class="co">#&gt; Distance threshold (km): 30</span></span>
<span><span class="co">#&gt; Number of filtered records: 78</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Original occurrence data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">spp1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Filtering with Moran's I"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">filt_geo1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Filtering with cell size"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">filt_geo2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Filtering with defined distance (30km)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">filt_geo3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/geo%20occurrence%20filtering-1.png" width="576"></p>
<p>Also, for the three methods, it is possible methods use several
values, turning easier the possibility to explore or test several
filtering values.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filt_geo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_geo.html">occfilt_geo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"moran"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prj <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">filt_geo2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_geo.html">occfilt_geo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cellsize"</span>, factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>, <span class="co"># coarser resolution than the provided raster</span></span>
<span>  prj <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">filt_geo3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_geo.html">occfilt_geo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"defined"</span>, d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prj <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># When several values are used, note the function returns a list with the filtered data</span></span>
<span><span class="va">filt_geo1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span>
<span><span class="va">filt_geo1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0.1" "0.2" "0.3" "0.5"</span></span>
<span></span>
<span><span class="co"># Let's plot the results with ggplot2</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">filt_geo1</span>, .id <span class="op">=</span> <span class="st">"moran"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>moran <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">moran</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">moran</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/geo%20occurrence%20filtering%20with%20different%20values-1.png" width="576"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">filt_geo2</span>, .id <span class="op">=</span> <span class="st">"cellsize"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>moran <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cellsize</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">cellsize</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/geo%20occurrence%20filtering%20with%20different%20values-2.png" width="576"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">filt_geo2</span>, .id <span class="op">=</span> <span class="st">"determined"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>moran <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">determined</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">determined</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/geo%20occurrence%20filtering%20with%20different%20values-3.png" width="576"></p>
<p>When tested filtering occurrence with different values, you can use
the <code><a href="../reference/occfilt_select.html">occfilt_select()</a></code> function to select the filtered
dataset that equilibrate spatial autocorrelation maximum number of
presences (see <code><a href="../reference/occfilt_select.html">occfilt_select()</a></code> function help)</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filt_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occfilt_select.html">occfilt_select</a></span><span class="op">(</span></span>
<span>  occ_list <span class="op">=</span> <span class="va">filt_geo2</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>, filter_prop <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Dataset with filtered value 8 was selected</span></span>
<span><span class="va">filt_selected</span></span>
<span><span class="co">#&gt; $occ</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 156 × 4</span></span></span>
<span><span class="co">#&gt;    species        x        y   idd</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">269</span><span style="color: #BB0000;">871.</span>   <span style="text-decoration: underline;">69</span>512.     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">149</span><span style="color: #BB0000;">991.</span>  <span style="text-decoration: underline;">267</span>962.     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sp1       <span style="text-decoration: underline;">91</span>659. -<span style="color: #BB0000; text-decoration: underline;">156</span><span style="color: #BB0000;">748.</span>     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">210</span><span style="color: #BB0000;">471.</span>  <span style="text-decoration: underline;">326</span>282.     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">140</span><span style="color: #BB0000;">541.</span>  <span style="text-decoration: underline;">284</span>972.     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">217</span><span style="color: #BB0000;">491.</span>   <span style="text-decoration: underline;">65</span>732.     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> sp1      -<span style="color: #BB0000; text-decoration: underline;">92</span><span style="color: #BB0000;">481.</span>  <span style="text-decoration: underline;">155</span>642.    12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">367</span><span style="color: #BB0000;">611.</span>  <span style="text-decoration: underline;">266</span>072.    13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">184</span><span style="color: #BB0000;">551.</span>  <span style="text-decoration: underline;">425</span>372.    15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> sp1     -<span style="color: #BB0000; text-decoration: underline;">260</span><span style="color: #BB0000;">151.</span>   <span style="text-decoration: underline;">57</span>632.    18</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 146 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $filter_prop</span></span>
<span><span class="co">#&gt;   filt_value mean_autocorr n_records       aet       cwd       tmx       tmn</span></span>
<span><span class="co">#&gt; 1          1     0.3219265       233 0.3534014 0.2017850 0.3352363 0.3972832</span></span>
<span><span class="co">#&gt; 2          5     0.2923551       189 0.3276294 0.1400721 0.3170405 0.3846783</span></span>
<span><span class="co">#&gt; 3        * 8     0.2602486       156 0.3055744 0.1287050 0.2635844 0.3431307</span></span>
<span><span class="co">#&gt; 4         12     0.2291901       118 0.2568785 0.1080880 0.2311247 0.3206691</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-partitioning">Data partitioning<a class="anchor" aria-label="anchor" href="#data-partitioning"></a>
</h2>
<p>Data partitioning, or splitting data into testing and training
groups, is a key step in building SDMs. <em>flexsdm</em> offers multiple
options for data partitioning, including part_random(), part_sband(),
part_sblock(), and part_senv(). Let’s explore each of these methods.</p>
<div class="section level3">
<h3 id="conventional-data-partitioning-methods-part_random">1. Conventional data partitioning methods (part_random)<a class="anchor" aria-label="anchor" href="#conventional-data-partitioning-methods-part_random"></a>
</h3>
<p>The part_random() function provides users the ability to divide
species occurrence data based on conventional partition methods
including k-folds, repeated k-folds, leave-one-out cross-validation, and
bootstrap partitioning.</p>
<p>Here, we use the “kfold” method with 10 folds to divide our data.
This results in 10 folds of occurrence data with 25 observations in each
fold.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spp1</span><span class="op">$</span><span class="va">pr_ab</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># Add a column with 1 to denote that this is presences only data</span></span>
<span><span class="va">sp_part1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kfold"</span>, folds <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sp_part1</span><span class="op">$</span><span class="va">.part</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt;  1  2  3  4  5  6  7  8  9 10 </span></span>
<span><span class="co">#&gt; 25 25 25 25 25 25 25 25 25 25</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatial-band-cross-validation-part_sband">2. Spatial band cross-validation (part_sband)<a class="anchor" aria-label="anchor" href="#spatial-band-cross-validation-part_sband"></a>
</h3>
<p>Both part_sband() and part_sblock() partition data based on their
position in geographic space. Geographically structured data
partitioning methods are especially useful if users want to evaluate
model transferability to different regions or time periods. The function
part_sband tests for different numbers of spatial partitions using
latitudinal or longitudinal bands and selects the best number of bands
for a given presence, presence-absence, or presence-background dataset.
This procedure is based on spatial autocorrelation, environmental
similarity, and the number of presence/absence records in each band
partition. The function’s output includes 1) a tibble with
presence/absence locations and the assigned partition number, 2) a
tibble with information about the best partition, and 3) a SpatRaster
showing the selected grid.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sp_part2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_sband.html">part_sband</a></span><span class="op">(</span></span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"lat"</span>, <span class="co"># specify bands across different degrees of longitude 'lon' or latitude 'lat'.</span></span>
<span>  min_bands <span class="op">=</span> <span class="fl">2</span>, <span class="co"># minimum number of spatial bands to be tested</span></span>
<span>  max_bands <span class="op">=</span> <span class="fl">20</span>, <span class="co"># maximum number of spatial bands to be tested</span></span>
<span>  n_part <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  prop <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 12 rows were excluded from database because NAs were found</span></span>
<span><span class="co">#&gt; The following number of bands will be tested:</span></span>
<span><span class="co">#&gt; 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20</span></span>
<span><span class="co">#&gt; Creating basic raster mask...</span></span>
<span><span class="co">#&gt; Searching for the optimal number of bands...</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sp_part2</span><span class="op">$</span><span class="va">grid</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">gray.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sp_part2</span><span class="op">$</span><span class="va">part</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">[</span><span class="va">sp_part2</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">.part</span><span class="op">]</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">19</span><span class="op">)</span><span class="op">[</span><span class="va">sp_part2</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">pr_ab</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/plot%20spatial%20band%20partition-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="spatial-block-cross-validation-part_sblock">3. Spatial block cross-validation (part_sblock)<a class="anchor" aria-label="anchor" href="#spatial-block-cross-validation-part_sblock"></a>
</h3>
<p>The part_sblock() function is very similar to part_sband() but
instead of bands it explores spatial blocks with different raster cells
sizes and returns the one that is best suited for the input dataset.
Here, we can see the data divided into different “blocks” for training
and testing.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_part3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_sblock.html">part_sblock</a></span><span class="op">(</span></span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  min_res_mult <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Minimum value used for multiplying raster resolution and define the finest resolution to be tested</span></span>
<span>  max_res_mult <span class="op">=</span> <span class="fl">500</span>, <span class="co"># Maximum value used for multiplying raster resolution and define the coarsest resolution to be tested</span></span>
<span>  num_grids <span class="op">=</span> <span class="fl">30</span>, <span class="co"># Number of grid to be tested between min_res_mult X (raster resolution) and max_res_mult X (raster resolution)</span></span>
<span>  n_part <span class="op">=</span> <span class="fl">2</span>, <span class="co"># Number of partitions</span></span>
<span>  prop <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># Proportion of points used for testing autocorrelation between groupds (0-1)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 12 rows were excluded from database because NAs were found</span></span>
<span><span class="co">#&gt; The following grid cell sizes will be tested:</span></span>
<span><span class="co">#&gt; 18900 | 50834.48 | 82768.97 | 114703.45 | 146637.93 | 178572.41 | 210506.9 | 242441.38 | 274375.86 | 306310.34 | 338244.83 | 370179.31 | 402113.79 | 434048.28 | 465982.76 | 497917.24 | 529851.72 | 561786.21 | 593720.69 | 625655.17 | 657589.66 | 689524.14 | 721458.62 | 753393.1 | 785327.59 | 817262.07 | 849196.55 | 881131.03 | 913065.52 | 945000</span></span>
<span><span class="co">#&gt; Creating basic raster mask...</span></span>
<span><span class="co">#&gt; Searching for the optimal grid size...</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sp_part3</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sp_part3</span><span class="op">$</span><span class="va">part</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">[</span><span class="va">sp_part3</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">.part</span><span class="op">]</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/spatial%20block%20partition-1.png" width="576"></p>
<p>However, we notice that the grid partition produced by part_sblock
has a different resolution than the original environmental variables. If
you want a map layer with the same properties (i.e. resolution, extent,
NAs) as your original environmental variables, apply the get_block()
function to the grid resulting from part_sblock(). This layer can be
really useful for generating pseudo-absence or background sample points,
which we will explore in the next section.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">sp_part3</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 881131 881131</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1890 1890</span></span>
<span></span>
<span><span class="va">grid_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_block.html">get_block</a></span><span class="op">(</span>env_layer <span class="op">=</span> <span class="va">somevar</span>, best_grid <span class="op">=</span> <span class="va">sp_part3</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_env</span><span class="op">)</span> <span class="co"># this is a block layer with the same layer</span></span>
<span><span class="co"># properties as environmental variables.</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sp_part3</span><span class="op">$</span><span class="va">part</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">[</span><span class="va">sp_part3</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">.part</span><span class="op">]</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/get%20block%20function-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="environmental-and-spatial-cross-validation-part_senv">4. Environmental and spatial cross-validation (part_senv)<a class="anchor" aria-label="anchor" href="#environmental-and-spatial-cross-validation-part_senv"></a>
</h3>
<p>The final partitioning function in <em>flexsdm</em> is part_senv(),
which explores different numbers of environmental partitions based on
the K-means clustering algorithm and returns the one best-suited for a
particular dataset, considering spatial autocorrelation, environmental
similarity, and the number of presence and/or absence records in each
partition. The map below shows partitioning based on these environmental
and spatial factors.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_part4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_senv.html">part_senv</a></span><span class="op">(</span></span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span>  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span>
<span>  min_n_groups <span class="op">=</span> <span class="fl">2</span>, <span class="co"># Minimum number of groups to be tested</span></span>
<span>  max_n_groups <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Maximum number of groups to be tested</span></span>
<span>  prop <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># Proportion of points used for testing autocorrelation between groups (0-1)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 12 rows were excluded from database because NAs were found</span></span>
<span><span class="co">#&gt; The following grid cell sizes will be tested:</span></span>
<span><span class="co">#&gt; 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10</span></span>
<span><span class="co">#&gt; Searching best partition...</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">regions</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">gray.colors</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sp_part4</span><span class="op">$</span><span class="va">part</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sp_part4</span><span class="op">$</span><span class="va">part</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">sp_part4</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">.part</span><span class="op">]</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/environmental%20and%20spatial%20cross-validation-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="background-and-pseudo-absence-sampling">Background and pseudo-absence sampling<a class="anchor" aria-label="anchor" href="#background-and-pseudo-absence-sampling"></a>
</h2>
<p>Presence-only occurrence data are quite common in ecology and
researchers may not have adequate “absence” data for their species of
interest. Sometimes in building species distribution models, we need to
be able to generate background or pseudo-absence points for the modeling
goals. The <em>flexsdm</em> package allows users to do this using
sample_background() and sample_pseudoabs().</p>
<div class="section level3">
<h3 id="sample-background">1. Sample background<a class="anchor" aria-label="anchor" href="#sample-background"></a>
</h3>
<p>The function sample_background() allows slection of background sample
points based on different geographic restrictions and sampling methods.
Here, we sample a set of background points based on our earlier spatial
block partitioning using the “random” method. Using lapply() in this
case ensures that we generate background points in each of our spatial
blocks (n = 2). We are also specifying that we want ten times the amount
of background points as our original occurrences and that our
calibration area will be the buffer area around presence points (see
section on “Calibration area”).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sp_part3</span><span class="op">$</span><span class="va">part</span> <span class="co"># presence data from spatial block partition example</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/sample_background.html">sample_background</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">p_data</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p_data</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>,</span>
<span>    <span class="co"># number of background points to be sampled</span></span>
<span>    method <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>    rlayer <span class="op">=</span> <span class="va">grid_env</span>,</span>
<span>    maskval <span class="op">=</span> <span class="va">x</span>,</span>
<span>    calibarea <span class="op">=</span> <span class="va">ca_1</span> <span class="co"># A SpatVector which delimit the calibration area used for a given species</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pr_ab <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_env</span>, main <span class="op">=</span> <span class="st">"Presence points"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca_1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">p_data</span>, cex <span class="op">=</span> <span class="fl">.7</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_env</span>, main <span class="op">=</span> <span class="st">"Background points"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca_1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">bg</span>, cex <span class="op">=</span> <span class="fl">.1</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/sample%20background-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="sample-pseudo-absences">2. Sample pseudo-absences<a class="anchor" aria-label="anchor" href="#sample-pseudo-absences"></a>
</h3>
<p>Similarly, the function sample_pseudoabs allows random pseudo-absence
sampling or based on environmental and/or geographical constraints. For
example, specifying method = “env_const” selects pseudo-absences that
are environmentally constrained to regions with lower suitability values
as predicted by a Bioclim model. Additionally, this function allows
users to specify a calibration area from which to generate
pseudo-absence points. Here, we will use the buffer area around presence
points (ca_1) to show what this might look like. As you can see, we have
generated pseudo-absence points that are in the general vicinity of our
presence points, but are concentrated in areas that have lower
environmental suitability. The specific method chosen for sampling
background and/or pseudo-absence points will vary depending on research
goals.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">psa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/sample_pseudoabs.html">sample_pseudoabs</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">p_data</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p_data</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span>,</span>
<span>    <span class="co"># number of pseudo-absence points to be sampled</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"env_const"</span>, env <span class="op">=</span> <span class="va">somevar</span><span class="op">)</span>,</span>
<span>    rlayer <span class="op">=</span> <span class="va">grid_env</span>,</span>
<span>    maskval <span class="op">=</span> <span class="va">x</span>,</span>
<span>    calibarea <span class="op">=</span> <span class="va">ca_1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pr_ab <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extents do not match, raster layers used were croped to minimum extent</span></span>
<span><span class="co">#&gt; Extents do not match, raster layers used were croped to minimum extent</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_env</span>, main <span class="op">=</span> <span class="st">"Presence points"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca_1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">p_data</span>, cex <span class="op">=</span> <span class="fl">.7</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_env</span>, main <span class="op">=</span> <span class="st">"Pseudo-absence points"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ca_1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">psa</span>, cex <span class="op">=</span> <span class="fl">.7</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_pre_modeling_files/figure-html/sample%20pseudo-absences-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="extracting-environmental-values">Extracting environmental values<a class="anchor" aria-label="anchor" href="#extracting-environmental-values"></a>
</h2>
<p>Finally, before modeling species geographic distributions, we must
extract environmental data at the presences +
absences/pseudo-absences/background point locations. The function
sdm_extract() extracts environmental data values based on x and y
coordinates and returns a tibble with the original data + additional
columns for the extracted environmental variables at those locations.
Let’s do this for our original presence points (spp1) and our background
locations (bg).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">spp1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">idd</span><span class="op">)</span>, <span class="va">bg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex_spp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_extract.html">sdm_extract</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">all_points</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  env_layer <span class="op">=</span> <span class="va">somevar</span>, <span class="co"># Raster with environmental variables</span></span>
<span>  variables <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Vector with the variable names of predictor</span></span>
<span>  <span class="co"># variables Usage variables. = c("aet", "cwd", "tmin"). If no variable is specified, function will return data for all layers.</span></span>
<span>  filter_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex_spp</span></span></code></pre></div>
<p>#=========#=========#=========#=========#=========#=========#=========#</p>
<p><strong>Vignette still under construction and changes</strong></p>
<p>#=========#=========#=========#=========#=========#=========#=========#</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Santiago J.E. Velazco, Brooke Rose, André F.A. Andrade, Ignacio Minoli, Janet Franklin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
