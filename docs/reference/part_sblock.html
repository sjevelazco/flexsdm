<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spatial block cross-validation — part_sblock • flexsdm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial block cross-validation — part_sblock"><meta name="description" content="This function explores spatial blocks with different cell sizes and returns the
most suitable size for a given presence or presence-absence database. The selection of the best
grid size is performed automatically considering spatial autocorrelation, environmental
similarity, and the number of presence and absence records in each partition."><meta property="og:description" content="This function explores spatial blocks with different cell sizes and returns the
most suitable size for a given presence or presence-absence database. The selection of the best
grid size is performed automatically considering spatial autocorrelation, environmental
similarity, and the number of presence and absence records in each partition."><meta name="google-site-verification" content="gcou8tqRTwNjZ_Mf1kbFgAzzUcY3OF-JB2sPRPTA56I"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">flexsdm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/v01_pre_modeling.html">1. Overview of Pre-modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v02_modeling.html">2. Overview of Modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v03_post_modeling.html">3. Overview of Post-modeling functions</a></li>
    <li><a class="dropdown-item" href="../articles/v04_Red_fir_example.html">4. An example with Red Fir</a></li>
    <li><a class="dropdown-item" href="../articles/v05_Rare_species_example.html">5. Modeling a rare species</a></li>
    <li><a class="dropdown-item" href="../articles/v06_Extrapolation_example.html">6. Tools to explore extrapolation in SDMs</a></li>
    <li><a class="dropdown-item" href="../articles/v07_Complete_workflow.html">7. Modeling workflow for several species</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/pkg_citation.html">Citations</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkg_citation.html">Citations</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
<li class="nav-item"><a class="nav-link" href="https://sjevelazco.github.io/flexsdm" aria-label="GitHub">GitHub</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sjevelazco/flexsdm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Spatial block cross-validation</h1>
      <small class="dont-index">Source: <a href="https://github.com/sjevelazco/flexsdm/blob/HEAD/R/part_sblock.R" class="external-link"><code>R/part_sblock.R</code></a></small>
      <div class="d-none name"><code>part_sblock.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function explores spatial blocks with different cell sizes and returns the
most suitable size for a given presence or presence-absence database. The selection of the best
grid size is performed automatically considering spatial autocorrelation, environmental
similarity, and the number of presence and absence records in each partition.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">part_sblock</span><span class="op">(</span></span>
<span>  <span class="va">env_layer</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">pr_ab</span>,</span>
<span>  n_part <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  min_res_mult <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_res_mult <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  num_grids <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  min_occ <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  prop <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-env-layer">env_layer<a class="anchor" aria-label="anchor" href="#arg-env-layer"></a></dt>
<dd><p>SpatRaster. Raster with environmental
variable. Used to evaluate spatial autocorrelation and
environmental similarity between training and testing partitions. Because this function
calculate dissimilarity based on Euclidean distances, it can only be used with continuous
environmental variables</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>data.frame. Data.frame or tibble object with presence
(or presence-absence, or presences-pseudo-absence) records, and coordinates</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>character. Column name with spatial x coordinates</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>character. Column name with spatial y coordinates</p></dd>


<dt id="arg-pr-ab">pr_ab<a class="anchor" aria-label="anchor" href="#arg-pr-ab"></a></dt>
<dd><p>character. Column with presence, presence-absence,
or pseudo-absence records. Presences must be represented by 1 and absences by 0</p></dd>


<dt id="arg-n-part">n_part<a class="anchor" aria-label="anchor" href="#arg-n-part"></a></dt>
<dd><p>integer. Number of partition. Default 2.</p></dd>


<dt id="arg-min-res-mult">min_res_mult<a class="anchor" aria-label="anchor" href="#arg-min-res-mult"></a></dt>
<dd><p>integer. Minimum value used for multiplying
raster resolution and define the finest resolution to be tested, default 3.</p></dd>


<dt id="arg-max-res-mult">max_res_mult<a class="anchor" aria-label="anchor" href="#arg-max-res-mult"></a></dt>
<dd><p>integer. Maximum value used for multiplying
raster resolution and define the coarsest resolution to be tested, default 200.</p></dd>


<dt id="arg-num-grids">num_grids<a class="anchor" aria-label="anchor" href="#arg-num-grids"></a></dt>
<dd><p>integer. Number of grid to be tested between
min_res_mult X (raster resolution) and max_res_mult X (raster resolution), default 30</p></dd>


<dt id="arg-min-occ">min_occ<a class="anchor" aria-label="anchor" href="#arg-min-occ"></a></dt>
<dd><p>numeric. Minimum number of presences or absences in a partition fold.
The min_occ value should be base on the amount of predictors in order to avoid over-fitting
or error when fitting models for a given fold. Default 10.</p></dd>


<dt id="arg-prop">prop<a class="anchor" aria-label="anchor" href="#arg-prop"></a></dt>
<dd><p>numeric. Proportion of point used for testing autocorrelation between
groups (values &gt; 0 and &lt;=1). The smaller this proportion is, the faster the function will work.
Default 0.5</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with:</p><ul><li><p>part: A tibble object with information used in 'data' arguments and a additional column
  .part with partition group.</p></li>
<li><p>best_part_info: A tibble with information about the best partition. It contains the
  number of the best partition (n_grid), cell size (cell_size), standard deviation of
  presences (sd_p), standard deviation of absences (sd_a), Moran's I spatial autocorrelation
  (spa_auto), and environmental similarity based on Euclidean distance (env_sim).</p></li>
<li><p>grid: A SpatRaster object with blocks</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The part_sblock allows test with different numbers of partitions using square blocks
(like a checkerboard). This function explores a range of block sizes and automatically selects
the best size for a given given presence, presence-absences, or presence-pseudo-absences
dataset. Number of partition selection is based on an optimization procedure that
explores partition size in three dimensions
determined by spatial autocorrelation (measured by Moran's I), environmental similarity
(Euclidean distance), and difference in the amount of data among partition groups
(Standard Deviation - SD; Velazco et al., 2019). This procedure will iteratively select partitions, first
those partitions with autocorrelation values less than the lowest quartile of Morans I, then
those with environmental similarity values greater than the third quartile of the Euclidean
distances than those with a difference in the amount of data less than the lowest quartile of SD.
This selection is repeated until only one partition is retained (Velazco et al., 2019). The
main benefit of this partition selection are that it i) is not subjective, ii) balances the
environmental similarity and special autocorrelation between partitions, and iii) controls
the selection of partitions with too few data that may be problematic for model fitting
("min_occ" argument).</p>
<p>Geographically structured partitions tend to evaluate model transferability more directly than
conventional ones (e.g., those performed by <code><a href="part_random.html">part_random</a></code>) (Roberts et al., 2017;
Santini et al., 2021), and are relevant for models that are to be used for projections in other
regions outside the calibration area or for other time periods.</p>
<p>This function can interact with <code><a href="get_block.html">get_block</a></code>, <code><a href="sample_background.html">sample_background</a></code>,
and <code><a href="sample_pseudoabs.html">sample_pseudoabs</a></code> for sampling background points or pseudo-absences within
spatial partition broups</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Roberts, D. R., Bahn, V., Ciuti, S., Boyce, M. S., Elith, J., Guillera-Arroita, G.,
Hauenstein, S., Lahoz-Monfort, J. J., Schroder, B., Thuiller, W., Warton, D. I., Wintle, B. A.,
Hartig, F., &amp; Dormann, C. F. (2017). Cross-validation strategies for data with temporal, spatial,
 hierarchical, or phylogenetic structure. Ecography, 40,
 913-929. https://doi.org/10.1111/ecog.02881</p></li>
<li><p>Santini, L., Benitez-Lopez, A., Maiorano, L., Cengic, M., &amp; Huijbregts, M. A. J. (2021).
 Assessing the reliability of species distribution projections in climate change research.
 Diversity and Distributions, ddi.13252. https://doi.org/10.1111/ddi.13252</p></li>
<li><p>Velazco, S. J. E., Villalobos, F., Galvao, F., &amp; De Marco Junior, P. (2019). A dark
scenario for Cerrado plant species: Effects of future climate, land use and protected areas
ineffectiveness. Diversity and Distributions, 25(4), 660-673. https://doi.org/10.1111/ddi.12886</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="part_random.html">part_random</a></code>, <code><a href="part_sband.html">part_sband</a></code>, <code><a href="part_senv.html">part_senv</a></code>,
<code><a href="get_block.html">get_block</a></code>, and <code><a href="plot_res.html">plot_res</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load datasets</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">spp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example for one single species</span></span></span>
<span class="r-in"><span><span class="va">single_spp</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp3"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">part</span> <span class="op">&lt;-</span> <span class="fu">part_sblock</span><span class="op">(</span></span></span>
<span class="r-in"><span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">single_spp</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="st">"x"</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="st">"y"</span>,</span></span>
<span class="r-in"><span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span></span>
<span class="r-in"><span>  min_res_mult <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  max_res_mult <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>  num_grids <span class="op">=</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>  n_part <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  min_occ <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  prop <span class="op">=</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">part</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">part</span><span class="op">$</span><span class="va">part</span> <span class="co"># database with partition fold (.part)</span></span></span>
<span class="r-in"><span><span class="va">part</span><span class="op">$</span><span class="va">part</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pr_ab</span>, <span class="va">.part</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># number of presences and absences in each fold</span></span></span>
<span class="r-in"><span><span class="va">part</span><span class="op">$</span><span class="va">best_part_info</span> <span class="co"># information of the best partition</span></span></span>
<span class="r-in"><span><span class="va">part</span><span class="op">$</span><span class="va">grid</span> <span class="co"># raster with folds</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Explore the Grid object</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">part</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">part</span><span class="op">$</span><span class="va">part</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">[</span><span class="va">part</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">.part</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  cex <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  pch <span class="op">=</span> <span class="fl">19</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">part</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that this is a layer with block partition, but it has a</span></span></span>
<span class="r-in"><span><span class="co"># different resolution than the original environmental variables.</span></span></span>
<span class="r-in"><span><span class="co"># If you wish have a layer with the same properties</span></span></span>
<span class="r-in"><span><span class="co"># (i.e. resolution, extent, NAs) as your original environmental</span></span></span>
<span class="r-in"><span><span class="co"># variables you can use the \code{\link{get_block}} function.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">grid_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_block.html">get_block</a></span><span class="op">(</span>env_layer <span class="op">=</span> <span class="va">somevar</span>, best_grid <span class="op">=</span> <span class="va">part</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_env</span><span class="op">)</span> <span class="co"># this is a block layer with the same layer</span></span></span>
<span class="r-in"><span><span class="co"># properties as environmental variables.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">part</span><span class="op">$</span><span class="va">part</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">[</span><span class="va">part</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">.part</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  cex <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  pch <span class="op">=</span> <span class="fl">19</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># This layer is very useful if you need to sample</span></span></span>
<span class="r-in"><span><span class="co"># pseudo_absence or background point</span></span></span>
<span class="r-in"><span><span class="co"># See examples in \code{\link{backgroudp}} and \code{\link{pseudoabs}}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example of a higher number of partitions</span></span></span>
<span class="r-in"><span><span class="va">part</span> <span class="op">&lt;-</span> <span class="fu">part_sblock</span><span class="op">(</span></span></span>
<span class="r-in"><span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">single_spp</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="st">"x"</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="st">"y"</span>,</span></span>
<span class="r-in"><span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span></span>
<span class="r-in"><span>  min_res_mult <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  max_res_mult <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>  num_grids <span class="op">=</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>  n_part <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  min_occ <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  prop <span class="op">=</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Explore the Grid object</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">part</span><span class="op">$</span><span class="va">grid</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">gray.colors</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">part</span><span class="op">$</span><span class="va">part</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="va">part</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">.part</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  cex <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  pch <span class="op">=</span> <span class="fl">19</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using these functions with several species</span></span></span>
<span class="r-in"><span><span class="va">spp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">spp</span>, <span class="va">spp</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">spp2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">spp2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spp2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">part_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">spp2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">part_sblock</span><span class="op">(</span></span></span>
<span class="r-in"><span>    env_layer <span class="op">=</span> <span class="va">somevar</span>,</span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">x</span>,</span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="st">"x"</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="st">"y"</span>,</span></span>
<span class="r-in"><span>    pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span></span>
<span class="r-in"><span>    min_res_mult <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>    max_res_mult <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>    num_grids <span class="op">=</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>    n_part <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    min_occ <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    prop <span class="op">=</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">result</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">part_list</span><span class="op">$</span><span class="va">sp3</span> <span class="co"># For this dataset a suitable partition was not found</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a single database for all species</span></span></span>
<span class="r-in"><span><span class="va">occ_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">part_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">occ_part</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the best grid info for all species</span></span></span>
<span class="r-in"><span><span class="va">grid_info</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">part_list</span>,</span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">)</span>, .id <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the best grid layer for all species</span></span></span>
<span class="r-in"><span><span class="va">grid_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">part_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">grid_layer2</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">grid_layer</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="get_block.html">get_block</a></span><span class="op">(</span>env_layer <span class="op">=</span> <span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, best_grid <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">grid_layer2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">grid_layer2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">grid_layer2</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_layer2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Block partition for presences-only database</span></span></span>
<span class="r-in"><span><span class="va">single_spp</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp1"</span>, <span class="va">pr_ab</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">single_spp</span></span></span>
<span class="r-in"><span><span class="va">single_spp</span><span class="op">$</span><span class="va">pr_ab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># only presences</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">part</span> <span class="op">&lt;-</span> <span class="fu">part_sblock</span><span class="op">(</span></span></span>
<span class="r-in"><span>  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">single_spp</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="st">"x"</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="st">"y"</span>,</span></span>
<span class="r-in"><span>  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,</span></span>
<span class="r-in"><span>  min_res_mult <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  max_res_mult <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>  num_grids <span class="op">=</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>  n_part <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  min_occ <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  prop <span class="op">=</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">part</span><span class="op">$</span><span class="va">part</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">part</span><span class="op">$</span><span class="va">best_part_info</span></span></span>
<span class="r-in"><span><span class="va">part</span><span class="op">$</span><span class="va">grid</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">part</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">part</span><span class="op">$</span><span class="va">part</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">[</span><span class="va">part</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">.part</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  cex <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  <span class="co">#' pch = 19</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Santiago J.E. Velazco, Brooke Rose, André F.A. Andrade, Ignacio Minoli, Janet Franklin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

